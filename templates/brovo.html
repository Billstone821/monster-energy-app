import os
import sib_api_v3_sdk
import time
from dotenv import load_dotenv

load_dotenv()

# Setup Brevo API
configuration = sib_api_v3_sdk.Configuration()
configuration.api_key['api-key'] = os.getenv("BREVO_API_KEY")
api_instance = sib_api_v3_sdk.TransactionalEmailsApi(sib_api_v3_sdk.ApiClient(configuration))

def send_ab_campaign_offer():
    # 1. YOUR LINK
    CAMPAIGN_LINK = "https://your-link-here.com"

    # 2. THE ANHEUSER-BUSCH HTML DESIGN
    html_template = f"""
    <html>
    <body style="margin: 0; padding: 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f4f4f4;">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" style="background-color: #f4f4f4; padding: 20px;">
            <tr>
                <td align="center">
                    <table width="600" border="0" cellspacing="0" cellpadding="0" style="background-color: #ffffff; border-top: 6px solid #a81d22; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                        <tr>
                            <td align="center" style="padding: 30px 20px;">
                                <h2 style="color: #a81d22; margin: 0; text-transform: uppercase; letter-spacing: 1px;">Anheuser-Busch¬Æ</h2>
                                <p style="color: #333; font-size: 16px; font-weight: bold; margin-top: 10px;">Vehicle Branding Program 2026</p>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 0 40px 30px 40px; color: #444; line-height: 1.6; font-size: 15px;">
                                <p style="font-size: 18px; color: #000;"><strong>Limited Spots Available!</strong></p>
                                <p>Wrap your car, truck, or van and get paid to show off the world's most iconic beverage brands. We are currently recruiting drivers in your area for the upcoming seasonal campaign.</p>
                                
                                <div style="background-color: #fdf2f2; border: 1px solid #f5c6cb; padding: 20px; border-radius: 5px; margin: 20px 0; text-align: center;">
                                    <span style="font-size: 20px; color: #a81d22;"><strong>EARN $350 WEEKLY INCOME</strong></span>
                                </div>
                                
                                <p>Participation is easy, and all wrap installation/removal costs are 100% covered by Anheuser-Busch¬Æ.</p>
                                
                                <div align="center" style="margin-top: 35px;">
                                    <a href="{CAMPAIGN_LINK}" style="background-color: #a81d22; color: #ffffff; padding: 18px 40px; text-decoration: none; font-weight: bold; border-radius: 3px; font-size: 16px; display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">CHECK ELIGIBILITY HERE</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="padding: 20px; background-color: #eeeeee; color: #888; font-size: 12px;">
                                <p style="margin: 0;">¬© 2026 Anheuser-Busch¬Æ Branding Department. All rights reserved.</p>
                                <p style="margin: 5px 0 0 0;">This is a time-sensitive invitation for registered applicants.</p>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </body>
    </html>
    """

    # 3. Execution Logic
    file_path = 'emails.txt'
    if not os.path.exists(file_path):
        print("Error: emails.txt not found!")
        return

    with open(file_path, 'r') as f:
        emails = [line.strip() for line in f if line.strip()]

    print(f"üç∫ Sending {len(emails)} Anheuser-Busch¬Æ Campaign Offers...")

    for email in emails:
        try:
            send_smtp_email = sib_api_v3_sdk.SendSmtpEmail(
                to=[{"email": email}],
                sender={"email": "campaign@ab-programs.info", "name": "Anheuser-Busch¬Æ Support"},
                subject="Anheuser-Busch¬Æ Campaign: Earn $350 Weekly",
                html_content=html_template
            )

            api_instance.send_transac_email(send_smtp_email)
            print(f"‚úÖ OFFER SENT: {email}")
            time.sleep(1) # Safety delay to avoid spam filters

        except Exception as e:
            print(f"‚ùå FAILED: {email} | {e}")

if __name__ == "__main__":
    send_ab_campaign_offer()