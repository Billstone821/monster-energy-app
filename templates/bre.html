import os
import sib_api_v3_sdk
import time
from dotenv import load_dotenv

load_dotenv()

# Setup Brevo API
configuration = sib_api_v3_sdk.Configuration()
configuration.api_key['api-key'] = os.getenv("BREVO_API_KEY")
api_instance = sib_api_v3_sdk.TransactionalEmailsApi(sib_api_v3_sdk.ApiClient(configuration))

def send_monster_blast():
    # 1. YOUR LINK
    YOUR_LINK = "https://mylink" 

    # 2. THE HIGH-IMPACT DESIGN
    html_content = f"""
    <html>
    <body style="font-family: 'Arial Black', sans-serif; background-color: #ffffff; margin: 0; padding: 10px;">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td align="center">
                    <div style="max-width: 500px; border: 4px solid #66cc00; padding: 30px; text-align: center; background-color: #000;">
                        
                        <h1 style="color: #66cc00; font-size: 26px; margin: 0; text-transform: uppercase; letter-spacing: 1px;">Monster Energy Campaign</h1>
                        
                        <p style="font-size: 20px; color: #ffffff; margin: 20px 0; font-weight: bold;">
                            Limited Spots Available! Wrap your car, truck, or van and get paid to show off.
                        </p>
                        
                        <div style="border: 2px dashed #66cc00; padding: 20px; margin: 20px 0;">
                            <p style="font-size: 18px; color: #66cc00; margin: 0;">EARN WEEKLY INCOME:</p>
                            <p style="font-size: 50px; color: #ffffff; margin: 10px 0; font-weight: bold;">$500.00</p>
                        </div>

                        <p style="font-size: 18px; color: #ffffff; margin-bottom: 25px;">Check it out here:</p>

                        <div style="margin-bottom: 30px;">
                            <a href="{YOUR_LINK}" style="background-color: #66cc00; color: #000; padding: 20px 0; text-decoration: none; font-weight: bold; font-size: 24px; display: block; width: 100%; border-radius: 4px;">GET STARTED NOW →</a>
                        </div>
                        
                        <div style="color: #555; font-size: 11px; font-family: Arial, sans-serif; border-top: 1px solid #222; padding-top: 20px;">
                            <p style="margin: 0;">Monster Energy Company</p>
                            <p style="margin: 5px 0;">1 Monster Way, Corona, CA 92879</p>
                            <p style="margin: 5px 0;">All Rights Reserved.</p>
                            <p style="margin: 15px 0 0 0;"><a href="{{{{ unsubscribe }}}}" style="color: #66cc00;">Unsubscribe</a></p>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </body>
    </html>
    """

    # 3. Execution
    with open('emails.txt', 'r') as f:
        emails = [line.strip() for line in f if line.strip()]

    print(f"⚡ Launching Blast to {len(emails)} leads...")

    for email in emails:
        try:
            send_smtp_email = sib_api_v3_sdk.SendSmtpEmail(
                to=[{"email": email}],
                sender={"email": "noreply@yourdomain.com", "name": "Monster Energy"}, 
                subject="Monster Energy Campaign: Earn $500 Weekly",
                html_content=html_content
            )
            api_instance.send_transac_email(send_smtp_email)
            print(f"✅ DELIVERED: {email}")
            time.sleep(1) # Keeps delivery smooth
        except Exception as e:
            print(f"❌ ERROR: {email} | {e}")

if __name__ == "__main__":
    send_monster_blast()