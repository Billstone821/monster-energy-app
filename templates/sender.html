import os
import sib_api_v3_sdk
import time
import random
from dotenv import load_dotenv

load_dotenv()

configuration = sib_api_v3_sdk.Configuration()
configuration.api_key['api-key'] = os.getenv("BREVO_API_KEY")
api_instance = sib_api_v3_sdk.TransactionalEmailsApi(sib_api_v3_sdk.ApiClient(configuration))

def send_plain_monster_blast():
    # 1. YOUR DETAILS
    YOUR_LINK = "https://your-link-here.com" 
    SENDER_EMAIL = "support@yourdomain.com" # Must be your authenticated domain

    with open('emails.txt', 'r') as f:
        emails = [line.strip() for line in f if line.strip()]

    print(f"üì° Sending {len(emails)} filter-proof messages...")

    for email in emails:
        try:
            # THE MESSAGE: Pure text, no fluff, straight to the point.
            text_message = f"""
Monster Energy Campaign: Limited Spots Available!

Wrap your car, truck, or van and get paid to show off.
Earn $500.00 weekly income.

Check it out here:
{YOUR_LINK}

--------------------------------------------------
Monster Energy Company
1 Monster Way, Corona, CA 92879
All Rights Reserved.

To stop receiving these alerts, reply "Unsubscribe" or click here: {{{{{{ unsubscribe }}}}}}
"""

            send_smtp_email = sib_api_v3_sdk.SendSmtpEmail(
                to=[{"email": email}],
                sender={"email": SENDER_EMAIL, "name": "Monster Energy Support"}, 
                subject="Regarding the $500/week branding offer", # Neutral subject
                text_content=text_message # Using text_content instead of html_content
            )

            api_instance.send_transac_email(send_smtp_email)
            print(f"‚úÖ DELIVERED (TEXT): {email}")
            
            # HUMAN-LIKE DELAY (1 to 3 seconds)
            time.sleep(random.uniform(1, 3)) 

        except Exception as e:
            print(f"‚ùå ERROR: {email} | {e}")

if __name__ == "__main__":
    send_plain_monster_blast()